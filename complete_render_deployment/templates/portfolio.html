<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePro - Portfolio Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --accent-blue: #00d4ff;
            --accent-green: #00ff88;
            --border-color: #30363d;
            --success-color: #238636;
            --danger-color: #da3633;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(33, 38, 45, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .navbar {
            background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
        }

        .portfolio-metric {
            padding: 1.5rem;
            text-align: center;
            border-right: 1px solid var(--border-color);
        }

        .portfolio-metric:last-child {
            border-right: none;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-change {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .text-success-clean { color: var(--accent-green) !important; }
        .text-warning-clean { color: #ffc107 !important; }
        .text-danger-clean { color: var(--danger-color) !important; }

        .progress-custom {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-custom {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green) 0%, var(--accent-blue) 100%);
            transition: width 0.8s ease;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-white" href="/">
                <i class="fas fa-chart-line me-2" style="color: var(--accent-blue);"></i>
                TradePro
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white me-3" href="/">
                    <i class="fas fa-home me-1"></i> Dashboard
                </a>
                <a class="nav-link text-white" href="/analysis">
                    <i class="fas fa-chart-bar me-1"></i> Analysis
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <!-- Portfolio Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <h4 class="mb-0">
                        <i class="fas fa-wallet me-2" style="color: var(--accent-blue);"></i>
                        Portfolio Management
                    </h4>
                    <p class="text-muted mb-0">Track your trading performance and account metrics</p>
                </div>
            </div>
        </div>

        <!-- Portfolio Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card">
                    <div class="row" id="portfolioMetrics">
                        <div class="col-md-3">
                            <div class="portfolio-metric">
                                <div class="metric-value text-success-clean">$500.00</div>
                                <div class="metric-label">Account Balance</div>
                                <div class="metric-change text-success-clean">+0.0%</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="portfolio-metric">
                                <div class="metric-value text-success-clean">$0.00</div>
                                <div class="metric-label">Total P&L</div>
                                <div class="metric-change text-muted">0.0%</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="portfolio-metric">
                                <div class="metric-value text-success-clean">75%</div>
                                <div class="metric-label">Win Rate</div>
                                <div class="metric-change text-success-clean">Target: 80%</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="portfolio-metric">
                                <div class="metric-value text-warning-clean">0</div>
                                <div class="metric-label">Active Positions</div>
                                <div class="metric-change text-muted">0 Total Trades</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Progress -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-target me-2" style="color: var(--accent-green);"></i>
                        Daily Target Progress
                    </h6>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">$0 / $50 Daily Target</span>
                        <span class="text-success-clean">0%</span>
                    </div>
                    <div class="progress-custom">
                        <div class="progress-bar-custom" style="width: 0%;"></div>
                    </div>
                    <small class="text-muted mt-2 d-block">Execute high-confidence signals to reach daily goal</small>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-chart-line me-2" style="color: var(--accent-blue);"></i>
                        Risk Management
                    </h6>
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">Risk per Trade</small>
                            <strong class="text-warning-clean">2-10%</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Max Leverage</small>
                            <strong class="text-warning-clean">15x</strong>
                        </div>
                    </div>
                    <hr class="my-3" style="border-color: var(--border-color);">
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">Risk Level</small>
                            <strong class="text-success-clean">Moderate</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Strategy</small>
                            <strong class="text-success-clean">Balanced</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trading Summary -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <h5 class="mb-3">
                        <i class="fas fa-history me-2" style="color: var(--accent-green);"></i>
                        Recent Trading Activity
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-dark">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Symbol</th>
                                    <th>Action</th>
                                    <th>Quantity</th>
                                    <th>Entry Price</th>
                                    <th>P&L</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="tradingHistory">
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <i class="fas fa-chart-line text-muted me-2"></i>
                                        No trading history yet. Execute your first signal to start tracking performance.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Statistics -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-trophy me-2" style="color: var(--accent-green);"></i>
                        Best Performance
                    </h6>
                    <div class="text-center">
                        <div class="metric-value text-success-clean">$0.00</div>
                        <div class="metric-label">Best Daily Profit</div>
                        <small class="text-muted">No trades executed yet</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-calendar-alt me-2" style="color: var(--accent-blue);"></i>
                        This Week
                    </h6>
                    <div class="text-center">
                        <div class="metric-value text-muted">$0.00</div>
                        <div class="metric-label">Weekly P&L</div>
                        <small class="text-muted">0 trades this week</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-calendar-check me-2" style="color: var(--accent-green);"></i>
                        This Month
                    </h6>
                    <div class="text-center">
                        <div class="metric-value text-muted">$0.00</div>
                        <div class="metric-label">Monthly P&L</div>
                        <small class="text-muted">0 trades this month</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class PortfolioDashboard {
            constructor() {
                this.init();
            }

            init() {
                this.loadPortfolioData();
                setInterval(() => {
                    this.loadPortfolioData();
                }, 30000);
            }

            async loadPortfolioData() {
                try {
                    const response = await fetch('/api/portfolio');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updatePortfolioMetrics(data.portfolio);
                    }
                } catch (error) {
                    console.error('Error loading portfolio data:', error);
                }
            }

            updatePortfolioMetrics(portfolio) {
                // Update portfolio metrics with real data
                const pnlClass = portfolio.total_pnl >= 0 ? 'text-success-clean' : 'text-danger-clean';
                const pnlSign = portfolio.total_pnl >= 0 ? '+' : '';
                
                // Calculate daily progress
                const dailyTarget = 50;
                const dailyProgress = Math.min((Math.abs(portfolio.total_pnl) / dailyTarget) * 100, 100);
                
                document.getElementById('portfolioMetrics').innerHTML = `
                    <div class="col-md-3">
                        <div class="portfolio-metric">
                            <div class="metric-value text-success-clean">$${portfolio.balance.toFixed(2)}</div>
                            <div class="metric-label">Account Balance</div>
                            <div class="metric-change ${pnlClass}">${pnlSign}${portfolio.pnl_percentage.toFixed(1)}%</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="portfolio-metric">
                            <div class="metric-value ${pnlClass}">${pnlSign}$${Math.abs(portfolio.total_pnl).toFixed(2)}</div>
                            <div class="metric-label">Total P&L</div>
                            <div class="metric-change ${pnlClass}">${pnlSign}${portfolio.pnl_percentage.toFixed(1)}%</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="portfolio-metric">
                            <div class="metric-value text-success-clean">${portfolio.win_rate.toFixed(0)}%</div>
                            <div class="metric-label">Win Rate</div>
                            <div class="metric-change ${portfolio.win_rate >= 75 ? 'text-success-clean' : 'text-warning-clean'}">Target: 80%</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="portfolio-metric">
                            <div class="metric-value text-warning-clean">${portfolio.active_positions}</div>
                            <div class="metric-label">Active Positions</div>
                            <div class="metric-change text-muted">${portfolio.total_trades} Total Trades</div>
                        </div>
                    </div>
                `;

                // Update daily progress bar
                const progressBar = document.querySelector('.progress-bar-custom');
                if (progressBar) {
                    progressBar.style.width = `${dailyProgress}%`;
                }

                console.log('Portfolio metrics updated successfully');
            }
        }

        // Initialize portfolio dashboard
        const portfolioDashboard = new PortfolioDashboard();
    </script>
</body>
</html>