<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradePro - Market Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --accent-blue: #00d4ff;
            --accent-green: #00ff88;
            --border-color: #30363d;
            --success-color: #238636;
            --danger-color: #da3633;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(33, 38, 45, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .navbar {
            background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
        }

        .analysis-metric {
            padding: 1rem;
            text-align: center;
            border-right: 1px solid var(--border-color);
        }

        .analysis-metric:last-child {
            border-right: none;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .text-success-clean { color: var(--accent-green) !important; }
        .text-warning-clean { color: #ffc107 !important; }
        .text-danger-clean { color: var(--danger-color) !important; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-white" href="/">
                <i class="fas fa-chart-line me-2" style="color: var(--accent-blue);"></i>
                TradePro
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white me-3" href="/">
                    <i class="fas fa-home me-1"></i> Dashboard
                </a>
                <a class="nav-link text-white" href="/portfolio">
                    <i class="fas fa-wallet me-1"></i> Portfolio
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <!-- Analysis Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <h4 class="mb-0">
                        <i class="fas fa-chart-bar me-2" style="color: var(--accent-blue);"></i>
                        Market Analysis
                    </h4>
                    <p class="text-muted mb-0">Advanced technical analysis and signal generation</p>
                </div>
            </div>
        </div>

        <!-- Market Metrics -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card">
                    <div class="row" id="analysisMetrics">
                        <div class="col-md-3">
                            <div class="analysis-metric">
                                <div class="metric-value text-success-clean">6</div>
                                <div class="metric-label">Active Signals</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="analysis-metric">
                                <div class="metric-value text-success-clean">91.5%</div>
                                <div class="metric-label">Avg Confidence</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="analysis-metric">
                                <div class="metric-value text-warning-clean">Neutral</div>
                                <div class="metric-label">Market Sentiment</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="analysis-metric">
                                <div class="metric-value text-success-clean">Low</div>
                                <div class="metric-label">Volatility</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signal Analysis -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="glass-card p-4">
                    <h5 class="mb-3">
                        <i class="fas fa-bullseye me-2" style="color: var(--accent-green);"></i>
                        Signal Analysis
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-dark">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Action</th>
                                    <th>Confidence</th>
                                    <th>Entry Price</th>
                                    <th>Leverage</th>
                                    <th>Risk/Reward</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="signalAnalysisTable">
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Gainers and Losers -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-arrow-trend-up me-2" style="color: var(--accent-green);"></i>
                        Top Gainers
                    </h6>
                    <div id="top-gainers-list">
                        <div class="text-center">
                            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-arrow-trend-down me-2" style="color: var(--danger-color);"></i>
                        Top Losers
                    </h6>
                    <div id="top-losers-list">
                        <div class="text-center">
                            <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Indicators -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-chart-area me-2" style="color: var(--accent-blue);"></i>
                        Technical Indicators
                    </h6>
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">RSI Average</small>
                            <strong class="text-warning-clean">52.3</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">MACD Signal</small>
                            <strong class="text-success-clean">Bullish</strong>
                        </div>
                    </div>
                    <hr class="my-3" style="border-color: var(--border-color);">
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">Support Level</small>
                            <strong class="text-success-clean">$0.520</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Resistance</small>
                            <strong class="text-danger-clean">$0.580</strong>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="glass-card p-4">
                    <h6 class="mb-3">
                        <i class="fas fa-tachometer-alt me-2" style="color: var(--accent-green);"></i>
                        Performance Metrics
                    </h6>
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">Win Rate</small>
                            <strong class="text-success-clean">78%</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Daily Target</small>
                            <strong class="text-success-clean">$50</strong>
                        </div>
                    </div>
                    <hr class="my-3" style="border-color: var(--border-color);">
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted d-block">Risk Level</small>
                            <strong class="text-warning-clean">Moderate</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Execution</small>
                            <strong class="text-success-clean">Ready</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class AnalysisDashboard {
            constructor() {
                this.init();
            }

            init() {
                this.loadSignalAnalysis();
                this.loadTopGainersLosers();
                setInterval(() => {
                    this.loadSignalAnalysis();
                    this.loadTopGainersLosers();
                }, 30000);
            }

            async loadSignalAnalysis() {
                try {
                    const response = await fetch('/api/signals');
                    const data = await response.json();
                    
                    if (data.success && data.signals) {
                        this.displaySignalTable(data.signals);
                    }
                } catch (error) {
                    console.error('Error loading signal analysis:', error);
                }
            }

            displaySignalTable(signals) {
                const tableBody = document.getElementById('signalAnalysisTable');
                
                if (!signals || signals.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No signals available</td></tr>';
                    return;
                }

                const rows = signals.map(signal => {
                    const confidenceClass = signal.confidence >= 90 ? 'text-success-clean' : 
                                          signal.confidence >= 80 ? 'text-warning-clean' : 'text-danger-clean';
                    const actionClass = signal.action === 'BUY' ? 'text-success-clean' : 'text-danger-clean';
                    const statusBadge = signal.confidence >= 90 ? 
                                       '<span class="badge bg-success">High</span>' :
                                       '<span class="badge bg-warning">Medium</span>';

                    return `
                        <tr>
                            <td><strong>${signal.symbol}</strong></td>
                            <td><span class="${actionClass}">${signal.action}</span></td>
                            <td><span class="${confidenceClass}">${signal.confidence}%</span></td>
                            <td>$${signal.entry_price.toFixed(4)}</td>
                            <td>${signal.leverage}x</td>
                            <td>1:${signal.risk_reward_ratio}</td>
                            <td>${statusBadge}</td>
                        </tr>
                    `;
                }).join('');

                tableBody.innerHTML = rows;
            }

            async loadTopGainersLosers() {
                try {
                    const response = await fetch('/api/top-gainers-losers');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.displayTopGainers(data.top_gainers);
                        this.displayTopLosers(data.top_losers);
                    }
                } catch (error) {
                    console.error('Error loading top gainers/losers:', error);
                }
            }

            displayTopGainers(gainers) {
                const container = document.getElementById('top-gainers-list');
                if (!gainers || gainers.length === 0) {
                    container.innerHTML = '<div class="text-muted">No data available</div>';
                    return;
                }

                const html = gainers.map(token => `
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom" style="border-color: var(--border-color);">
                        <div>
                            <strong>${token.symbol}</strong>
                            <small class="text-muted d-block">$${token.price.toFixed(4)}</small>
                        </div>
                        <div class="text-end">
                            <span class="text-success-clean">+${token.change_24h.toFixed(2)}%</span>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = html;
            }

            displayTopLosers(losers) {
                const container = document.getElementById('top-losers-list');
                if (!losers || losers.length === 0) {
                    container.innerHTML = '<div class="text-muted">No data available</div>';
                    return;
                }

                const html = losers.map(token => `
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom" style="border-color: var(--border-color);">
                        <div>
                            <strong>${token.symbol}</strong>
                            <small class="text-muted d-block">$${token.price.toFixed(4)}</small>
                        </div>
                        <div class="text-end">
                            <span class="text-danger-clean">${token.change_24h.toFixed(2)}%</span>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = html;
            }
        }

        // Initialize analysis dashboard
        const analysisDashboard = new AnalysisDashboard();
    </script>
</body>
</html>